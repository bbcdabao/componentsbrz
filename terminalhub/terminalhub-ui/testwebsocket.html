<html>
  <head>
    <title>远程登录测试</title>
    <meta charset="utf-8" />
  </head>

  <body>
    <p>
      <textarea id="sowline" class="textaStyle"></textarea>
    </p>
    <p>
      <input type="text" id="cmdline" value="" onkeydown="enterPress(event);" class="inputStyle">
    </p>	
	  <p>
      <button onclick="sendMessage()">发送命令</button>
    </p>
    <script>
      let socket = new WebSocket("ws://127.0.0.1:9090/bbadabao?sessionfactory=sshfactory");
	  document.getElementById("sowline").append("# linking ...\n");
      socket.onerror = err => {
	    document.getElementById("sowline").append("# linking err\n");
        console.log(err);
      };
      socket.onopen = event => {
	    document.getElementById("sowline").append("# linking ok you can enter cmd\n");
        console.log(event);
      };
      socket.onmessage = mess => {
        document.getElementById("sowline").append("# " + mess.data);
      };
      socket.onclose = () => {
        document.getElementById("sowline").append("# linking closed\n");
      };
	  
	  function enterPress(e) {
	    if (e.keyCode == 13) {
		  sendMessage();
		}
	  };
	  
      function sendMessage() {
        if (socket.readyState === 1) {
		  document.getElementById("sowline").append("# " + document.getElementById("cmdline").value + "\n");
		  
		  socket.send(document.getElementById("cmdline").value);
		  
		  document.getElementById("cmdline").value="";
		} else {
		  alert("尚未建立websocket连接");
		}
      }
    </script>
	<style>
	  .textaStyle{
	    width: 500px;
        height:300px;
        overflow-x:hidden;
        background-color: #000000;
		color: #FFFFFF;
	  }
      .inputStyle{
	    width: 500px;	
	  }
	</style>
  </body>
</html>
