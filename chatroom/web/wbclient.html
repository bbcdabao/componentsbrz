<html>
  <head>
    <title>远程登录测试</title>
    <meta charset="utf-8" />
  </head>

  <body>
  	<p style="display: flex; align-items: center; white-space: nowrap;">
	  <input style="width: 50%;" type="text" id="register" placeholder="注册中心 / register" value="">
	  <input style="width: 50%;" type="text" id="name" placeholder="姓名 / name" value="">
	  <button style="width: 100px;" onclick="doregister()">注册 / reg</button>
	</p>
    <p>
      <textarea id="sowline" class="textaStyle"></textarea>
    </p>
    <p style="display: flex; align-items: center; white-space: nowrap;">
      <input style="width: 100%;" type="text" id="cmdline" value="" onkeydown="enterPress(event);">
	  <button style="width: 100px;" onclick="sendMessage()">发送 / send</button>
    </p>
    <script>
	  let socket = null
	  function doregister() {
	    let registerGet = document.getElementById("register").value.trim();
	    if (registerGet === "") {
          console.log("输入框为空");
		  alert("输入注册中心地址 / enter register addr");
		  return;
        }
	    let nameGet = document.getElementById("name").value.trim();
	    if (nameGet === "") {
          console.log("输入框为空");
		  alert("输入您的名字 / enter your name");
		  return;
        }
		socket = new WebSocket("ws://" + registerGet + "/bbcdabao?sessionfactory=chatroom&" + "name=" + nameGet);
	    document.getElementById("sowline").append("# linking ...\n");
        socket.onerror = err => {
	      document.getElementById("sowline").append("# linking err\n");
          console.log(err);
        };
        socket.onopen = event => {
	      document.getElementById("sowline").append("# linking ok you can enter cmd\n");
          console.log(event);
        };
        socket.onmessage = mess => {
          document.getElementById("sowline").append("# " + mess.data);
        };
        socket.onclose = () => {
          document.getElementById("sowline").append("# linking closed\n");
        };
      };
	  function enterPress(e) {
	    if (e.keyCode == 13) {
		  sendMessage();
		}
	  };
      function sendMessage() {
        if (socket != null  && socket.readyState === 1) {
		  document.getElementById("sowline").append("# " + document.getElementById("cmdline").value + "\n");
		  socket.send(document.getElementById("cmdline").value);
		  document.getElementById("cmdline").value="";
		} else {
		  alert("尚未建立websocket连接 / not register");
		}
      }
    </script>
	<style>
	  .textaStyle{
	    width: 100%;
        height: calc(100% - 100px);
        overflow-x:hidden;
        background-color: #000000;
		color: #FFFFFF;
	  }
	</style>
  </body>
</html>
